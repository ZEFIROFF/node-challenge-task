# Конфигурация приложения

Тут лежат все настройки приложения. Вместо того чтобы хардкодить значения по всему коду, мы собрали их в одном месте.

## Как это работает

Все настройки берутся из переменных окружения (`.env` файл). Каждый файл отвечает за свою область:

### app.config.ts

Главные настройки приложения:

- На каком порту запускаться
- Как часто обновлять цены (каждые 5 секунд)
- Сколько токенов обновлять за раз (по 5 штук)
- При какой разнице цены слать сообщение (от 0.1%)

### database.config.ts

Всё что связано с базой данных:

- Куда подключаться (хост, порт)
- Логин/пароль
- Название базы
- Готовая строка подключения для Prisma

### kafka.config.ts

Настройки для отправки сообщений в Kafka:

- Адреса серверов Kafka (можно несколько через запятую)
- ID клиента и название топика

### circuit-breaker.config.ts

Защита от падений внешнего сервиса цен:

- Сколько ошибок допустить до отключения (5 раз)
- Как долго ждать перед повтором (30 секунд)
- Таймаут на запрос (5 секунд)

### outbox.config.ts

Настройки отправки сообщений через Outbox паттерн:

- Сколько сообщений отправлять за раз (50 штук)
- Как часто проверять (каждую секунду)
- Сколько раз пытаться повторить при ошибке (3 раза)

## Валидация

В `validation/env.validation.ts` проверяем что все переменные корректные:

- Порт от 1 до 65535
- Проценты от 0 до 100
- Все обязательные поля заполнены

Если что-то не так - приложение не запустится и сразу покажет ошибку.

## Использование

Все конфиги подключены через NestJS ConfigService. В любом месте кода можно заинжектить ConfigService и получить нужное
значение:

```typescript
this.configService.get('app.port')
this.configService.get('kafka.brokers')
```

У всех переменных есть дефолтные значения, поэтому приложение запустится даже без `.env` файла. Но навсякий случай есть
`.env.example`
